!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs/Rx"),require("@angular/core")):"function"==typeof define&&define.amd?define(["exports","rxjs/Rx","@angular/core"],e):e((t.ngidle=t.ngidle||{},t.ngidle.core=t.ngidle.core||{}),t.Rx,t.ng.core)}(this,function(t,e,n){"use strict";var i=function(){function t(t,e,n){void 0===n&&(n=!1),this.source=t,this.innerArgs=e,this.force=n}return t}(),o=function(){function t(t,e){this.attachFn=t,this.detachFn=e,this.isAttached=!1,this.onInterrupt=new n.EventEmitter}return t.prototype.attach=function(){!this.isAttached&&this.attachFn&&this.attachFn(this),this.isAttached=!0},t.prototype.detach=function(){this.isAttached&&this.detachFn&&this.detachFn(this),this.isAttached=!1},t}(),r=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},s=function(t){function n(n,o,r){var s=this;void 0===r&&(r=500),t.call(this,null,null),this.target=n,this.events=o,this.throttleDelay=r,this.eventSrc=new Array,this.eventSubscription=new Array;var u=this;o.split(" ").forEach(function(t){var i=e.Observable.fromEvent(n,t);u.throttleDelay>0&&(i=i.throttleTime(u.throttleDelay)),u.eventSrc.push(i)});var a=function(t){if(!u.filterEvent(t)){var e=new i(this,t);u.onInterrupt.emit(e)}};this.attachFn=function(){s.eventSrc.forEach(function(t){u.eventSubscription.push(t.subscribe(a))})},this.detachFn=function(){s.eventSubscription.forEach(function(t){t.unsubscribe()}),s.eventSubscription.length=0}}return r(n,t),n.prototype.filterEvent=function(t){return!1},n}(o),u=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=function(t){function e(e,n){void 0===n&&(n=500),t.call(this,document.documentElement,e,n)}return u(e,t),e.prototype.filterEvent=function(t){return!("mousemove"!==t.type||!(t.originalEvent&&0===t.originalEvent.movementX&&0===t.originalEvent.movementY||void 0!==t.movementX&&!t.movementX)&&t.movementY)},e}(s),l=function(){function t(){this.idValue=new Date}return t.prototype.id=function(t){if(void 0!==t){if(!t)throw new Error("A value must be specified for the ID.");this.idValue=t}return this.idValue},t.prototype.now=function(){return new Date},t.prototype.isExpired=function(){var t=this.last();return null!=t&&t<=this.now()},t}(),h=function(){function t(t){this.source=t}return t.prototype.subscribe=function(t){this.sub=this.source.onInterrupt.subscribe(t)},t.prototype.unsubscribe=function(){this.sub.unsubscribe(),this.sub=null},t.prototype.resume=function(){this.source.attach()},t.prototype.pause=function(){this.source.detach()},t}(),p=function(){function t(){}return t}();!function(t){t[t.disabled=0]="disabled",t[t.idle=1]="idle",t[t.notIdle=2]="notIdle"}(t.AutoResume||(t.AutoResume={}));var c=function(){function e(e,i){this.expiry=e,this.idle=1200,this.timeoutVal=30,this.autoResume=t.AutoResume.idle,this.interrupts=new Array,this.running=!1,this.idling=!1,this.keepaliveEnabled=!1,this.onIdleStart=new n.EventEmitter,this.onIdleEnd=new n.EventEmitter,this.onTimeoutWarning=new n.EventEmitter,this.onTimeout=new n.EventEmitter,this.onInterrupt=new n.EventEmitter,i&&(this.keepaliveSvc=i,this.keepaliveEnabled=!0)}return e.prototype.getKeepaliveEnabled=function(){return this.keepaliveEnabled},e.prototype.setKeepaliveEnabled=function(t){if(!this.keepaliveSvc)throw new Error("Cannot enable keepalive integration because no KeepaliveSvc has been provided.");return this.keepaliveEnabled=t},e.prototype.getTimeout=function(){return this.timeoutVal},e.prototype.setTimeout=function(t){if(t===!1)this.timeoutVal=0;else{if(!("number"==typeof t&&t>=0))throw new Error("'seconds' can only be 'false' or a positive number.");this.timeoutVal=t}return this.timeoutVal},e.prototype.getIdle=function(){return this.idle},e.prototype.setIdle=function(t){if(t<=0)throw new Error("'seconds' must be greater zero");return this.idle=t},e.prototype.getAutoResume=function(){return this.autoResume},e.prototype.setAutoResume=function(t){return this.autoResume=t},e.prototype.setInterrupts=function(t){this.clearInterrupts();for(var e=this,n=0,i=t;n<i.length;n++){var o=i[n],r=new h(o);r.subscribe(function(t){e.interrupt(t.force,t.innerArgs)}),this.interrupts.push(r)}return this.interrupts},e.prototype.getInterrupts=function(){return this.interrupts},e.prototype.clearInterrupts=function(){for(var t=0,e=this.interrupts;t<e.length;t++){var n=e[t];n.pause(),n.unsubscribe()}this.interrupts.length=0},e.prototype.isRunning=function(){return this.running},e.prototype.isIdling=function(){return this.idling},e.prototype.watch=function(t){var e=this;this.safeClearInterval("idleHandle"),this.safeClearInterval("timeoutHandle");var n=this.timeoutVal?this.timeoutVal:0;if(!t){var i=new Date(this.expiry.now().getTime()+1e3*(this.idle+n));this.expiry.last(i)}this.idling&&this.toggleState(),this.running||(this.startKeepalive(),this.toggleInterrupts(!0)),this.running=!0,this.idleHandle=setInterval(function(){e.toggleState()},1e3*this.idle)},e.prototype.stop=function(){this.stopKeepalive(),this.toggleInterrupts(!1),this.safeClearInterval("idleHandle"),this.safeClearInterval("timeoutHandle"),this.idling=!1,this.running=!1,this.expiry.last(null)},e.prototype.timeout=function(){this.stopKeepalive(),this.toggleInterrupts(!1),this.safeClearInterval("idleHandle"),this.safeClearInterval("timeoutHandle"),this.idling=!0,this.running=!1,this.countdown=0,this.onTimeout.emit(null)},e.prototype.interrupt=function(e,n){if(this.running){if(this.timeoutVal&&this.expiry.isExpired())return void this.timeout();this.onInterrupt.emit(n),(e===!0||this.autoResume===t.AutoResume.idle||this.autoResume===t.AutoResume.notIdle&&!this.idling)&&this.watch(e)}},e.prototype.toggleState=function(){var t=this;this.idling=!this.idling,this.idling?(this.onIdleStart.emit(null),this.stopKeepalive(),this.timeoutVal>0&&(this.countdown=this.timeoutVal,this.doCountdown(),this.timeoutHandle=setInterval(function(){t.doCountdown()},1e3))):(this.toggleInterrupts(!0),this.onIdleEnd.emit(null),this.startKeepalive()),this.safeClearInterval("idleHandle")},e.prototype.toggleInterrupts=function(t){for(var e=0,n=this.interrupts;e<n.length;e++){var i=n[e];t?i.resume():i.pause()}},e.prototype.doCountdown=function(){if(this.idling){if(this.countdown<=0)return void this.timeout();this.onTimeoutWarning.emit(this.countdown),this.countdown--}},e.prototype.safeClearInterval=function(t){this[t]&&(clearInterval(this[t]),this[t]=null)},e.prototype.startKeepalive=function(){this.keepaliveSvc&&this.keepaliveEnabled&&(this.running&&this.keepaliveSvc.ping(),this.keepaliveSvc.start())},e.prototype.stopKeepalive=function(){this.keepaliveSvc&&this.keepaliveEnabled&&this.keepaliveSvc.stop()},e.prototype.ngOnDestroy=function(){this.stop(),this.clearInterrupts()},e.decorators=[{type:n.Injectable}],e.ctorParameters=[{type:l},{type:p,decorators:[{type:n.Optional}]}],e}(),d=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},f=function(t){function e(e,n){void 0===n&&(n=500),t.call(this,window,e,n)}return d(e,t),e}(s),v=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},m=function(t){function e(){t.call(this),this.lastValue=null}return v(e,t),e.prototype.last=function(t){return void 0!==t&&(this.lastValue=t),this.lastValue},e}(l),y=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[m,{provide:l,useExisting:m},c]}},t.decorators=[{type:n.NgModule}],t.ctorParameters=[],t}(),g=[new a("mousemove keydown DOMMouseScroll mousewheel mousedown touchstart touchmove scroll")];t.DEFAULT_INTERRUPTSOURCES=g,t.NgIdleModule=y,t.Idle=c,t.InterruptArgs=i,t.InterruptSource=o,t.EventTargetInterruptSource=s,t.DocumentInterruptSource=a,t.WindowInterruptSource=f,t.KeepaliveSvc=p,t.IdleExpiry=l,t.SimpleExpiry=m,Object.defineProperty(t,"__esModule",{value:!0})});
